#' Get activities from Strava
#'
#' Get activities from the authenticated user as a data frame
#'
#' @import httr
#' @import assertthat
#' @import plyr
#' @import rjson
#'
#' @export
strava_activities <- function(){
  if(!strava_check_existing_token()){
    return(invisible(FALSE))
  }

  url <- "https://www.strava.com/api/v3/activities/"
  data <- GET(url, config(token = StravaAuth$public_fields$token))

  data <- rjson::fromJSON(rawToChar(data$content))

  activities <- NULL

  for(i in 1:(length(data))){
    if (!is.null(unlist(data[[i]]))){
      act <- data.frame(matrix(unlist(data[[i]]), nrow=1))
      colnames(act) <- names(unlist(data[[i]]))
      activities <- plyr::rbind.fill(activities, act)
    }
  }

  return(activities)
}
